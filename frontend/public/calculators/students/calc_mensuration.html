<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SMART HUB | Master Geometry Suite</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/custom.css">
    <style>
        .mode-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .mode-btn {
            flex: 1;
            min-width: 100px;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-main);
            cursor: pointer;
            transition: 0.3s;
            font-weight: bold;
        }

        .mode-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            box-shadow: 0 4px 12px rgba(var(--accent-rgb), 0.3);
        }

        .visual-container {
            background: #ffffff;
            border-radius: 12px;
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 25px;
            min-height: 300px;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .view-switch {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .v-btn {
            padding: 5px 10px;
            font-size: 0.7rem;
            border-radius: 4px;
            border: 1px solid #ddd;
            cursor: pointer;
            background: #fff;
        }

        .v-btn.active {
            background: var(--accent-color);
            color: #fff;
        }

        svg {
            max-width: 100%;
            height: auto;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>

<body>
    <div class="dashboard-layout" id="dashboard-wrapper">
        <div class="overlay" id="mobile-overlay"></div>
        <div id="sidebar-placeholder"></div>

        <main class="main-content">
            <div id="header-placeholder"></div>

            <div class="page-body">
                <section class="container fade-in">
                    <div class="mode-toggle stagger-1">
                        <button class="mode-btn active" onclick="setDimension('2d')">2D Shapes</button>
                        <button class="mode-btn" onclick="setDimension('3d')">3D Solids</button>
                    </div>

                    <div class="cat-card stagger-1">
                        <div class="calculator-header">
                            <h2><i class="fa-solid fa-layer-group"></i> Master Geometry & Nets</h2>
                            <p>Calculate properties and visualize the "Net" (unfolded) view of solids.</p>
                        </div>

                        <div class="sub-cat-list">
                            <div class="sub-link">
                                <span>Select Shape</span>
                                <select id="shape-select" class="form-control" onchange="updateInputs()"></select>
                            </div>

                            <div id="dynamic-inputs" class="sub-cat-list"></div>

                            <div class="sub-link">
                                <span>Stroke & Fill</span>
                                <div style="display: flex; gap: 10px; width: 100%;">
                                    <input type="color" id="stroke-color" value="#4a90e2"
                                        style="width:50%; height:35px; cursor:pointer;">
                                    <input type="color" id="fill-color" value="#4a90e2"
                                        style="width:50%; height:35px; cursor:pointer;">
                                </div>
                            </div>

                            <button id="calc-btn" class="btn-calc" style="margin-top: 15px;">Calculate &
                                Generate</button>
                        </div>
                    </div>

                    <div id="results" class="cat-card stagger-2 hidden" style="display: none; margin-top: 20px;">
                        <div class="grid-section"
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            <div>
                                <h3><i class="fa-solid fa-calculator"></i> Results</h3>
                                <div class="sub-cat-list" id="result-display-area"></div>
                            </div>
                            <div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <h3><i class="fa-solid fa-cube"></i> Visualization</h3>
                                    <div class="view-switch" id="view-switch-container">
                                        <button class="v-btn active" onclick="setView('solid')">Solid</button>
                                        <button class="v-btn" onclick="setView('net')">Net</button>
                                    </div>
                                </div>
                                <div class="visual-container" id="svg-output"></div>
                            </div>
                        </div>
                    </div>
                </section>
                <div id="footer-placeholder"></div>
            </div>
        </main>
    </div>

    <script>
        window.FRONTEND_ROOT = "/";
        window.COMPONENT_ROOT = "/components/";

        let dimension = '2d';
        let currentView = 'solid'; // 'solid' or 'net'

        const config = {
            '2d': {
                square: {
                    fields: ['Side (a)'],
                    fn: (a) => ({ Area: a * a, Perimeter: 4 * a }),
                    svg: (a, s, f) => `<rect x="60" y="60" width="80" height="80" stroke="${s}" stroke-width="2" fill="${f}" fill-opacity="0.2"/><text x="100" y="155" font-size="12" text-anchor="middle">a=${a}</text>`
                },
                rectangle: {
                    fields: ['Length (l)', 'Width (w)'],
                    fn: (l, w) => ({ Area: l * w, Perimeter: 2 * (l + w) }),
                    svg: (l, w, s, f) => `<rect x="40" y="60" width="120" height="80" stroke="${s}" stroke-width="2" fill="${f}" fill-opacity="0.2"/><text x="100" y="55" text-anchor="middle">l=${l}</text><text x="165" y="105">w=${w}</text>`
                },
                circle: {
                    fields: ['Radius (r)'],
                    fn: (r) => ({ Area: Math.PI * r * r, Circum: 2 * Math.PI * r }),
                    svg: (r, s, f) => `<circle cx="100" cy="100" r="60" stroke="${s}" stroke-width="2" fill="${f}" fill-opacity="0.2"/><line x1="100" y1="100" x2="160" y2="100" stroke="${s}" stroke-dasharray="3"/><text x="110" y="95" font-size="10">r=${r}</text>`
                },
                triangle: {
                    fields: ['Base (b)', 'Height (h)'],
                    fn: (b, h) => ({ Area: 0.5 * b * h }),
                    svg: (b, h, s, f) => `<polygon points="100,40 40,160 160,160" stroke="${s}" stroke-width="2" fill="${f}" fill-opacity="0.2"/><line x1="100" y1="40" x2="100" y2="160" stroke="${s}" stroke-dasharray="3"/><text x="105" y="100" font-size="10">h=${h}</text><text x="100" y="175" text-anchor="middle">b=${b}</text>`
                }
            },
            '3d': {
                cube: {
                    fields: ['Side (a)'],
                    fn: (a) => ({ Volume: a ** 3, 'Surf. Area': 6 * a * a }),
                    solid: (a, s, f) => `<path d="M60 80 L110 50 L160 80 L160 130 L110 160 L60 130 Z" fill="${f}" fill-opacity="0.2" stroke="${s}" stroke-width="2"/><path d="M60 80 L110 110 L160 80 M110 110 L110 160" fill="none" stroke="${s}" stroke-width="1.5"/><text x="115" y="140" font-size="10">a=${a}</text>`,
                    net: (a, s, f) => `<rect x="70" y="30" width="40" height="40" stroke="${s}" fill="${f}" fill-opacity="0.1"/><rect x="30" y="70" width="120" height="40" stroke="${s}" fill="${f}" fill-opacity="0.1"/><rect x="70" y="70" width="40" height="40" stroke="${s}" fill="${f}" fill-opacity="0.3"/><rect x="70" y="110" width="40" height="40" stroke="${s}" fill="${f}" fill-opacity="0.1"/><rect x="70" y="150" width="40" height="40" stroke="${s}" fill="${f}" fill-opacity="0.1"/><text x="155" y="95" font-size="8">Net: 6 Squares</text>`
                },
                cuboid: {
                    fields: ['Length (l)', 'Width (w)', 'Height (h)'],
                    fn: (l, w, h) => ({ Volume: l * w * h, 'Surf. Area': 2 * (l * w + l * h + w * h) }),
                    solid: (l, w, h, s, f) => `<path d="M50 80 L100 50 L180 50 L130 80 Z M50 80 L50 140 L130 140 L130 80 Z M130 80 L180 50 L180 110 L130 140 Z" fill="${f}" fill-opacity="0.2" stroke="${s}" stroke-width="2"/><text x="90" y="155" font-size="10">l=${l}</text><text x="160" y="135" font-size="10">w=${w}</text><text x="40" y="110" font-size="10">h=${h}</text>`,
                    net: (l, w, h, s, f) => `<rect x="60" y="20" width="40" height="30" stroke="${s}" fill="${f}" fill-opacity="0.1"/><rect x="20" y="50" width="120" height="40" stroke="${s}" fill="${f}" fill-opacity="0.1"/><rect x="60" y="50" width="40" height="40" stroke="${s}" fill="${f}" fill-opacity="0.3"/><rect x="60" y="90" width="40" height="30" stroke="${s}" fill="${f}" fill-opacity="0.1"/><rect x="60" y="120" width="40" height="40" stroke="${s}" fill="${f}" fill-opacity="0.1"/><text x="150" y="100" font-size="8">Net View</text>`
                },
                cylinder: {
                    fields: ['Radius (r)', 'Height (h)'],
                    fn: (r, h) => ({ Volume: Math.PI * r * r * h, 'Surf. Area': 2 * Math.PI * r * (r + h) }),
                    solid: (r, h, s, f) => `<ellipse cx="100" cy="60" rx="50" ry="20" fill="${f}" fill-opacity="0.2" stroke="${s}" stroke-width="2"/><path d="M50 60 L50 140 A50 20 0 0 0 150 140 L150 60" fill="${f}" fill-opacity="0.1" stroke="${s}" stroke-width="2"/><ellipse cx="100" cy="140" rx="50" ry="20" fill="none" stroke="${s}" stroke-dasharray="3"/><text x="155" y="105" font-size="10">h=${h}</text>`,
                    net: (r, h, s, f) => `<circle cx="100" cy="45" r="25" stroke="${s}" fill="${f}" fill-opacity="0.1"/><rect x="50" y="70" width="100" height="60" stroke="${s}" fill="${f}" fill-opacity="0.2"/><circle cx="100" cy="155" r="25" stroke="${s}" fill="${f}" fill-opacity="0.1"/><text x="155" y="105" font-size="8">2Ï€r x h</text>`
                },
                sphere: {
                    fields: ['Radius (r)'],
                    fn: (r) => ({ Volume: (4 / 3) * Math.PI * Math.pow(r, 3), 'Surf. Area': 4 * Math.PI * r * r }),
                    solid: (r, s, f) => `<circle cx="100" cy="100" r="70" fill="${f}" fill-opacity="0.2" stroke="${s}" stroke-width="2"/><ellipse cx="100" cy="100" rx="70" ry="20" fill="none" stroke="${s}" stroke-dasharray="3"/><text x="100" y="100" font-size="10">r=${r}</text>`,
                    net: (r, s, f) => `<text x="100" y="100" text-anchor="middle" font-size="12">Sphere cannot be flattened perfectly.</text>`
                },
                cone: {
                    fields: ['Radius (r)', 'Height (h)'],
                    fn: (r, h) => ({ Volume: (1 / 3) * Math.PI * r * r * h, 'Surf. Area': Math.PI * r * (r + Math.sqrt(h * h + r * r)) }),
                    solid: (r, h, s, f) => `<ellipse cx="100" cy="150" rx="50" ry="20" fill="${f}" fill-opacity="0.2" stroke="${s}" stroke-width="2"/><path d="M50 150 L100 30 L150 150" fill="${f}" fill-opacity="0.1" stroke="${s}" stroke-width="2"/><line x1="100" y1="30" x2="100" y2="150" stroke="${s}" stroke-dasharray="3"/><text x="105" y="90" font-size="10">h=${h}</text>`,
                    net: (r, h, s, f) => `<path d="M100 100 L40 160 A85 85 0 0 1 160 160 Z" fill="${f}" fill-opacity="0.2" stroke="${s}"/><circle cx="100" cy="100" r="5" fill="${s}"/><circle cx="100" cy="180" r="20" fill="${f}" fill-opacity="0.2" stroke="${s}"/><text x="100" y="80" text-anchor="middle">Sector + Circle</text>`
                }
            }
        };

        function setDimension(dim) {
            dimension = dim;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase().includes(dim)));
            document.getElementById('view-switch-container').style.visibility = (dim === '3d') ? 'visible' : 'hidden';
            const sel = document.getElementById('shape-select');
            sel.innerHTML = Object.keys(config[dim]).map(s => `<option value="${s}">${s.toUpperCase()}</option>`).join('');
            updateInputs();
        }

        function setView(view) {
            currentView = view;
            document.querySelectorAll('.v-btn').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase() === view));
            render();
        }

        function updateInputs() {
            const shape = document.getElementById('shape-select').value;
            const fields = config[dimension][shape].fields;
            document.getElementById('dynamic-inputs').innerHTML = fields.map((f, i) => `<div class="sub-link"><span>${f}</span><input type="number" class="form-control val-input" id="val-${i}" value="10"></div>`).join('');
        }

        function render() {
            const shape = document.getElementById('shape-select').value;
            const vals = Array.from(document.querySelectorAll('.val-input')).map(i => parseFloat(i.value) || 0);
            const stroke = document.getElementById('stroke-color').value;
            const fill = document.getElementById('fill-color').value;
            const data = config[dimension][shape];

            const results = data.fn(...vals);
            document.getElementById('result-display-area').innerHTML = Object.entries(results).map(([k, v]) => `<div class="sub-link"><span>${k}</span><strong>${v.toFixed(2)}</strong></div>`).join('');

            const svgContent = (dimension === '3d') ? data[currentView](...vals, stroke, fill) : data.svg(...vals, stroke, fill);
            document.getElementById('svg-output').innerHTML = `<svg width="250" height="250" viewBox="0 0 200 200">${svgContent}</svg>`;
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').classList.remove('hidden');

            if (window.setLastCalc) {
                const resultsString = Object.entries(results).map(([k, v]) => `${k}: ${v.toFixed(2)}`).join(' | ');
                window.setLastCalc("Master Geometry", `Shape: ${shape.toUpperCase()}`, resultsString);
            }
        }

        document.getElementById('calc-btn').addEventListener('click', render);
        setDimension('2d');
    </script>

    <script src="/js/component-loader.js"></script>
    <script type="module" src="/js/script.js"></script>
    <script src="/js/calculators.js"></script>
    <script src="/js/custom.js"></script>
</body>

</html>