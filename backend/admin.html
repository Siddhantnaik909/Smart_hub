<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SmartHub Admin Panel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f4f4f4;
      color: #333;
    }
    header {
      background: #222;
      color: #fff;
      padding: 10px;
      text-align: center;
    }
    nav button {
      margin: 5px;
      padding: 8px 12px;
      background: #444;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    nav button:hover {
      background: #666;
    }
    section {
      display: none;
      padding: 20px;
    }
    section.active {
      display: block;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    ul li {
      background: #ddd;
      margin: 5px 0;
      padding: 8px;
    }
    .dark-mode {
      background: #121212;
      color: #eee;
    }
    textarea {
      width: 100%;
      font-family: monospace;
    }
    pre {
      background: #eee;
      padding: 5px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <header>
    <h1>SmartHub Admin Control</h1>
    <nav>
      <button onclick="showSection('dashboard')">Dashboard</button>
      <button onclick="showSection('calculators')">Calculators</button>
      <button onclick="showSection('history')">History</button>
      <button onclick="showSection('settings')">Settings</button>
      <button onclick="showSection('roles')">Roles</button>
      <button onclick="showSection('files')">File Manager</button>
      <button onclick="showSection('code')">Code Preview</button>
    </nav>
  </header>

  <main>
    <!-- Dashboard -->
    <section id="dashboard" class="active">
      <h2>Overview</h2>
      <p>Total Tools: <span id="toolCount">0</span></p>
      <p>Total Calculations: <span id="calcCount">0</span></p>
      <p>Last Active: <span id="lastActive">Never</span></p>
    </section>

    <!-- Calculator Management -->
    <section id="calculators">
      <h2>Manage Calculators</h2>
      <input type="text" id="newCalcName" placeholder="Calculator Name">
      <button onclick="addCalculator()">Add Calculator</button>
      <ul id="calcList"></ul>
    </section>

    <!-- History -->
    <section id="history">
      <h2>Calculation History</h2>
      <button onclick="exportHistory()">Export CSV</button>
      <button onclick="clearHistory()">Clear History</button>
      <ul id="historyList"></ul>
    </section>

    <!-- Settings -->
    <section id="settings">
      <h2>Settings</h2>
      <label><input type="checkbox" id="darkMode" onchange="toggleTheme()"> Dark Mode</label><br>
      <label><input type="checkbox" id="autoSave"> Auto-Save History</label><br>
      <label><input type="checkbox" id="metricUnits"> Metric Units</label>
    </section>

    <!-- Roles -->
    <section id="roles">
      <h2>Role Management</h2>
      <select id="roleSelect">
        <option>Admin</option>
        <option>User</option>
        <option>Guest</option>
      </select>
      <button onclick="setRole()">Set Role</button>
      <p>Current Role: <span id="currentRole">Guest</span></p>
    </section>

    <!-- File Manager -->
    <section id="files">
      <h2>File Management</h2>
      <input type="file" id="fileUpload" multiple>
      <button onclick="uploadFiles()">Upload</button>
      <ul id="fileList"></ul>
    </section>

    <!-- Code Preview -->
    <section id="code">
      <h2>Code Preview & Version Control</h2>
      <textarea id="codeEditor" rows="10">// Write calculator logic here...</textarea><br>
      <button onclick="saveVersion()">Save Version</button>
      <ul id="versionList"></ul>
    </section>
  </main>

  <script>
    // Fallback idea: Try backend, else use LocalStorage
    const backendURL = "https://your-backend-api.com/data";

    // Section switching
    function showSection(id) {
      document.querySelectorAll("section").forEach(sec => sec.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    // Calculator Management
    function addCalculator() {
      const name = document.getElementById("newCalcName").value;
      if (!name) return;
      let calculators = JSON.parse(localStorage.getItem("calculators")) || [];
      calculators.push(name);
      localStorage.setItem("calculators", JSON.stringify(calculators));
      renderCalculators();
    }

    function renderCalculators() {
      let calculators = JSON.parse(localStorage.getItem("calculators")) || [];
      document.getElementById("toolCount").innerText = calculators.length;
      const list = document.getElementById("calcList");
      list.innerHTML = "";
      calculators.forEach((calc, i) => {
        list.innerHTML += `<li>${calc} <button onclick="deleteCalculator(${i})">Delete</button></li>`;
      });
    }

    function deleteCalculator(index) {
      let calculators = JSON.parse(localStorage.getItem("calculators")) || [];
      calculators.splice(index, 1);
      localStorage.setItem("calculators", JSON.stringify(calculators));
      renderCalculators();
    }

    // History Management
    function exportHistory() {
      let history = JSON.parse(localStorage.getItem("history")) || [];
      let csv = "Calculation,Result\n" + history.map(h => `${h.input},${h.output}`).join("\n");
      let blob = new Blob([csv], { type: "text/csv" });
      let link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "history.csv";
      link.click();
    }

    function clearHistory() {
      localStorage.removeItem("history");
      renderHistory();
    }

    function renderHistory() {
      let history = JSON.parse(localStorage.getItem("history")) || [];
      document.getElementById("calcCount").innerText = history.length;
      const list = document.getElementById("historyList");
      list.innerHTML = "";
      history.forEach(h => {
        list.innerHTML += `<li>${h.input} = ${h.output}</li>`;
      });
    }

    // Settings
    function toggleTheme() {
      document.body.classList.toggle("dark-mode", document.getElementById("darkMode").checked);
    }

    // Role Management
    function setRole() {
      const role = document.getElementById("roleSelect").value;
      localStorage.setItem("role", role);
      document.getElementById("currentRole").innerText = role;
    }

    // File Management
    function uploadFiles() {
      const files = document.getElementById("fileUpload").files;
      let fileList = JSON.parse(localStorage.getItem("files")) || [];
      for (let f of files) {
        fileList.push(f.name);
      }
      localStorage.setItem("files", JSON.stringify(fileList));
      renderFiles();
    }

    function renderFiles() {
      let files = JSON.parse(localStorage.getItem("files")) || [];
      const list = document.getElementById("fileList");
      list.innerHTML = "";
      files.forEach((file, i) => {
        list.innerHTML += `<li>${file} <button onclick="deleteFile(${i})">Delete</button></li>`;
      });
    }

    function deleteFile(index) {
      let files = JSON.parse(localStorage.getItem("files")) || [];
      files.splice(index, 1);
      localStorage.setItem("files", JSON.stringify(files));
      renderFiles();
    }

    // Code Preview & Version Control
    function saveVersion() {
      const code = document.getElementById("codeEditor").value;
      let versions = JSON.parse(localStorage.getItem("versions")) || [];
      versions.push({ code, date: new Date().toLocaleString() });
      localStorage.setItem("versions", JSON.stringify(versions));
      renderVersions();
    }

    function renderVersions() {
      let versions = JSON.parse(localStorage.getItem("versions")) || [];
      const list = document.getElementById("versionList");
      list.innerHTML = "";
      versions.forEach((v, i) => {
        list.innerHTML += `<li>Version ${i+1} (${v.date}) <pre>${v.code}</pre></li>`;
      });
    }

    // Init